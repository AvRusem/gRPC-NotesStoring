# Cервис заметок на gRPC

## Описание

Необходимо реализовать сервис на Go и клиент на Java для хранения и управления заметками, используя gRPC в качестве транспортного протокола. 

**Внимание!** Репозиторий с решением не должен содержать сгенерированных файлов. Они должны генерироваться командами `go generate` или `gradle build`.

## Базовая часть

### 1. Общие требования

- Сервер должен реализовывать взаимодействие с клиентами, используя gRPC.
- Сервер должен использовать in-memory хранилище для данных.
- Единственный аргументы сервера - это строка для прослушивания, как и в предыдущих заданиях, например `:8080`.
- Сервер должен принимать входящие gRPC-запросы без использования TLS-шифрования.
- Клиент должен запрашивать данные у сервера, используя gRPC.

### 2. Требования к API

Сервер должен реализовывать gRPC методы для работы с заметками (создание, чтение, изменение, удаление и поиск).

Строгих требований к API нет, ты можешь реализовать интерфейс взаимодействия на своё усмотрение.

### 3. Требования к Java-клиенту

- Необходимо реализовать Gradle-проект с классом `ru.culab.week11.NotesClient`, который имплементирует интерфейс `ru.culab.week11.NotesConnectable`. Файлы с интерфейсом и заготовкой класса ты найдёшь в шаблоне репозитория.

```java
public interface NotesConnectable {
    
    // Подключиться к gRPC-серверу
    void connectToServer(String hostName, int port) throws Exception;

    // Закрыть gRPC-коннект и освободить ресурсы
    void close();

    // Создать заметку. Возвращает ID созданной заметки
    long createNote(String title, String content) throws Exception;

    // Получить заметку по ID. Возвращается массив из 2-х элементов: название и текст заметки
    String[] getNoteTitleAndContent(long id) throws Exception;

    // Обновить существующую заметку по ID.
    void updateNote(long id, String title, String content) throws Exception;

    // Удалить заметку
    void deleteNote(long id) throws Exception;

    // Вернуть ID всех заметок, в которых встречается pattern
    long[] searchNotes(String pattern) throws Exception;
    
}
```

## Дополнительные требования

- В случае, если сервер запускается с двумя аргументами командной строки, то вторая строка определяет способ подключения к базе данных, и все заметки должны храниться в базе данных.
- Схему базы данных можешь спроектировать так, как считаешь нужным, но поля для хранения заголовков и содержимого заметок должны иметь в таблице тип `TEXT`.

Аргументы запуска сервера в этом случае:

- адрес для прослушивания (например, `:8080`);
- DSN строка подключения к БД (например, `postgres://user:password@localhost:5432/notes?sslmode=disable`).

## Пример использования

1. Запуск сервера (базовая часть):

```bash
./notes-server "0.0.0.0:8080"
```

2. Запуск сервера (бонусная часть):

```bash
./notes-server "0.0.0.0:8080" "postgres://user:password@localhost:5432/notes?sslmode=disable"
```

3. Использование клиента:

```java
NotesConnectable client = new NotesClient();
try {
    // Подключение к gRPC-серверу
    client.connectToServer("localhost", 8080);

    // Создание заметки
    long id = client.createNote("Заголовок", "Содержимое");

    // Получение заметки
    String[] note = client.getNoteTitleAndContent(id);
    System.out.println("Заметка #" + id);
    System.out.println("Заголовок: " + note[0]);
    System.out.println("Содержимое: " + note[1]);

    // Обновление заметки
    client.updateNote(id, "Новый заголовок", "Новое содержимое");

    // Поиск заметок
    long[] results = client.searchNotes("поисковый запрос");
    System.out.println("Найдено заметок: " + results.length);

    // Удаление заметки
    client.deleteNote(id);
} finally {
    // Закрытие соединения
    client.close();
}
```

## Советы по реализации

1. Раздели код на слои:
   - gRPC сервер,
   - бизнес-логика,
   - хранилища,
   - утилиты.

2. Обрати внимание:

- на потокобезопасность сервера и хранилища;
- корректную обработку ошибок и преобразование в правильные gRPC-статусы;
- тестирование всех компонентов.


